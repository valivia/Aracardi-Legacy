
# Docker-Compose for db

## Commands
### To start
#### First Time Prerequisites
**Note** remove any previous old versions of containers generated by older  `docker-compose.yml`

Generate a keyfile called `shared.key` in the keyfile directory using
```
openssl rand -base64 741 > ./keyfile/shared.key
```

To start run
```
docker-compose -f docker-compose.yml up -d
```

Initiate the replica set (For first time setup)
```
docker exec -it mongo_db mongosh -u root -p example --eval \
"rs.initiate({_id: 'rs0', members: [{_id: 0, host: 'localhost:27017'}]});"
```



### To kill (and remove volumes (WILL PURGE DB))
```
docker-compose down --volumes
```

- Optionally run docker volume prune with above
```
docker-compose down --volumes && docker volume prune
```

If you do not want to delete the db data, don't use the `--volumes` option or prune

### To push prisma schema
```
npx prisma db push 
```

**Connection String Note**
Add the query parameter `directConnection=true` like so:
```
mongodb://root:example@localhost:9305/cardgame?authSource=admin&directConnection=true
```
